# Spring Boot for Web
 

## [Web](https://docs.spring.io/spring-boot/docs/current/reference/html/web.html)

Starters:
- Web MVC: *spring-boot-starter-web* 
- Reactive: *spring-boot-starter-webflux* 

## Web MVC:
- MVC: @Controller/@RestController: handle incoming HTTP requests, and @RequestMapping: map controller methods to HTTP requests 
- WebMvc.fn: the functional variant,separates the routing configuration from the actual handling of the requests
```
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.http.MediaType;
import org.springframework.web.servlet.function.RequestPredicate;
import org.springframework.web.servlet.function.RouterFunction;
import org.springframework.web.servlet.function.ServerResponse;

import static org.springframework.web.servlet.function.RequestPredicates.accept;
import static org.springframework.web.servlet.function.RouterFunctions.route;

@Configuration(proxyBeanMethods = false)
public class MyRoutingConfiguration {
    private static final RequestPredicate ACCEPT_JSON = accept(MediaType.APPLICATION_JSON);
    @Bean
    public RouterFunction<ServerResponse> routerFunction(MyUserHandler userHandler) {
        return route()
                .GET("/{user}", ACCEPT_JSON, userHandler::getUser)
                .GET("/{user}/customers", ACCEPT_JSON, userHandler::getUserCustomers)
                .DELETE("/{user}", ACCEPT_JSON, userHandler::deleteUser)
                .build();
    }
}

import org.springframework.stereotype.Component;
import org.springframework.web.servlet.function.ServerRequest;
import org.springframework.web.servlet.function.ServerResponse;
@Component
public class MyUserHandler {
    public ServerResponse getUser(ServerRequest request) {
        ...
        return ServerResponse.ok().build();
    }    
```

### Spring MVC Auto-configuration: @Configuration and @EnableWebMvc
Auto-configured Beans for WebApplication, can be customized on interceptors, formatters, view controllers, and other features.
- Inclusion of **ContentNegotiatingViewResolver** and **BeanNameViewResolver** beans.
- Support for serving static resources, including support for WebJars, and static index.html, using *spring.mvc.static-path-pattern*
- Automatic registration of **Converter, GenericConverter**, and **Formatter** beans. use **WebMvcConfigurer** to add more.
- Support for **HttpMessageConverters** for JSON and XML, use it to add moew
- Automatic registration of **MessageCodesResolver**, generating error codes for rendering error messages from binding errors
- Automatic use of a **ConfigurableWebBindingInitializer** bean
- Customized Error Handling and Error Pages in /error directory for html or template, or via ErrorViewResolver.
- CORS Support using @CrossOrigin or register **WebMvcConfigurer** bean for Global CORS config
- Support JAX-RS using Jersey or Apache CXF for REST endpoints,
- Embedded Servlet Container: Registering Servlets, Filters, and Listeners as Spring Beans for @WebServlet, @WebFilter, and @WebListener when @ServletComponentScan is enabled 

#### JAX-RS Annotations
- @Path:  Relative path of the resource class/method.
- @GET: HTTP Get request, used to fetch resource.
- @PUT: HTTP PUT request, used to update resource.
- @POST: HTTP POST request, used to create a new resource.
- @DELETE: HTTP DELETE request, used to delete resource.
- @HEAD:  HTTP HEAD request, used to get status of method availability.
- @Produces: States the HTTP Response generated by web service. For example, APPLICATION/XML, TEXT/HTML, APPLICATION/JSON etc.
- @Consumes:  States the HTTP Request type. For example, application/x-www-formurlencoded to accept form data in HTTP body during POST request.
- @PathParam: Binds the parameter passed to the method to a value in path.
- @QueryParam: Binds the parameter passed to method to a query parameter in the path.
- @MatrixParam: Binds the parameter passed to the method to a HTTP matrix parameter in path.
- @HeaderParam: Binds the parameter passed to the method to a HTTP header.
- @CookieParam: Binds the parameter passed to the method to a Cookie.
- @FormParam: Binds the parameter passed to the method to a form value.
- @DefaultValue: Assigns a default value to a parameter passed to the method.
- @Context:  Context of the resource. For example, HTTPRequest as a context.

## Reactive Web: Mono\<?>/Flux\<?>
- Reactive Web: similar to Web MVC
- Reactive Web.fn: similar to Web.fn, separated Routing and Handling

### Auto Configuration: @Configuration and @EnableWebFlux.
- Configuring codecs for **HttpMessageReader** and **HttpMessageWriter** instances to convert HTTP requests and responses
- Support for serving static resources, including support for WebJars, using *spring.webflux.static-path-pattern*
 

## Graceful Shutdown: 
```
server.shutdown=graceful
spring.lifecycle.timeout-per-shutdown-phase=20s
```

## Spring Security: 
The default UserDetailsService has a single user. The user(*spring.security.user.name*) name is **user**, and the password(spring.security.user.password) is random and is printed at WARN level when started. 
### MVC Security
### WebFlux Security (*spring-boot-starter-security*)
### OAuth2 Client (*spring-security-oauth2-client*)
### OAuth2 Resource Server (*spring-security-oauth2-resource-server*)
### OAuth2 Authorization Server (*spring-security-oauth2-autoconfigure*)
### SAML 2.0

## Spring Session
Storage (*spring.session.store-type*) using @Enable\*HttpSession for Web MVC and  @Enable\*WebSession for Web Flux:
- JDBC
- Redis (Reactive)
- Hazelcast
- MongoDB (Reactive)

## Spring GraphQL
Alternative to REST, GraphQL lets developers construct requests that pull data from multiple data sources in a single API call. The client specify the exact types and fields it needs; and if not need much, that introduces the potential to make the API requests smaller.

Need *spring-boot-starter-graphql* and one or more transport starters, *spring-boot-starter-web/HTTP; spring-boot-starter-websocket/WebSocket; spring-boot-starter-webflux/HTTP, WebSocket; spring-boot-starter-rsocket/TCP,WebSocket* to expose the API.  

A Spring GraphQL application requires a defined schema at startup. By default, The ".graphqls" or ".gqls" schema files under src/main/resources/graphql/** and picked automatically. They can be customized with spring.graphql.schema.locations and spring.graphql.schema.file-extensions.

Spring Data repositories annotated with @GraphQlRepository and extending one of:
- QuerydslPredicateExecutor
- ReactiveQuerydslPredicateExecutor
- QueryByExampleExecutor
- ReactiveQueryByExampleExecutor

## Spring HATEOAS
Use starter *spring-boot-starter-hateoas* 

